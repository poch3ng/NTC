âœ… ç›®æ¨™

ç•¶ è¤‡è£½ PanelTemplate æ™‚ï¼Œç¢ºä¿ DropDownList (DDL) ä¹ŸæˆåŠŸè¤‡è£½ åˆ°æ–°çš„ Panelï¼Œä¸¦ä¸”ä¿æŒå…¶é¸é …å’Œé¸æ“‡å€¼ã€‚


---

ğŸ”¹ è§£æ±ºæ–¹æ¡ˆ

1. ä½¿ç”¨ CloneControl() æ–¹æ³•ä¾†è¤‡è£½ DropDownList


2. ç¢ºä¿è¤‡è£½çš„ DropDownList ä¿æŒåŸæœ‰çš„é¸é …


3. å¦‚æœ PostBack ä¹‹å¾Œï¼ŒDropDownList ä»ç„¶ä¿ç•™é¸æ“‡çš„å€¼


4. ä¿®æ”¹ ClonePanel() ä¾†ç¢ºä¿ DropDownList ä¹Ÿè¢«è¤‡è£½




---

âœ… 1ï¸âƒ£ CloneControl() - ç¢ºä¿ DropDownList è¢«è¤‡è£½

' âœ… è¤‡è£½æ§åˆ¶é …ï¼ˆåŒ…å« DropDownListï¼‰
Private Function CloneControl(ctrl As Control, prefix As String) As Control
    If TypeOf ctrl Is Label Then
        Dim originalLabel As Label = DirectCast(ctrl, Label)
        Dim newLabel As New Label()
        newLabel.ID = prefix & "_" & originalLabel.ID
        newLabel.Text = originalLabel.Text
        newLabel.CssClass = originalLabel.CssClass
        Return newLabel
    ElseIf TypeOf ctrl Is TextBox Then
        Dim originalTextBox As TextBox = DirectCast(ctrl, TextBox)
        Dim newTextBox As New TextBox()
        newTextBox.ID = prefix & "_" & originalTextBox.ID
        newTextBox.Text = originalTextBox.Text
        newTextBox.CssClass = originalTextBox.CssClass
        Return newTextBox
    ElseIf TypeOf ctrl Is DropDownList Then
        Dim originalDDL As DropDownList = DirectCast(ctrl, DropDownList)
        Dim newDDL As New DropDownList()
        newDDL.ID = prefix & "_" & originalDDL.ID
        newDDL.CssClass = originalDDL.CssClass

        ' âœ… è¤‡è£½ DropDownList çš„æ‰€æœ‰é¸é …
        For Each item As ListItem In originalDDL.Items
            newDDL.Items.Add(New ListItem(item.Text, item.Value))
        Next

        ' âœ… ä¿æŒé¸æ“‡å€¼
        newDDL.SelectedValue = originalDDL.SelectedValue

        Return newDDL
    End If

    Return Nothing ' å…¶ä»–é¡å‹çš„æ§åˆ¶é …å¯è¦–éœ€æ±‚æ·»åŠ 
End Function


---

âœ… 2ï¸âƒ£ ClonePanel() - ç¢ºä¿ DropDownList ä¹Ÿè¤‡è£½

' âœ… è¤‡è£½ Panel ä¸¦ç¢ºä¿ DropDownList ä¹Ÿè¢«è¤‡è£½
Private Function ClonePanel(original As Panel, newID As String) As Panel
    Dim newPanel As New Panel()
    newPanel.ID = newID
    newPanel.CssClass = original.CssClass
    newPanel.BorderStyle = original.BorderStyle
    newPanel.BorderWidth = original.BorderWidth
    newPanel.Width = original.Width
    newPanel.Visible = False ' âœ… é è¨­éš±è—

    ' âœ… è¤‡è£½ Panel å…§çš„æ‰€æœ‰æ§åˆ¶é …ï¼ˆåŒ…å« DropDownListï¼‰
    For Each ctrl As Control In original.Controls
        Dim newCtrl As Control = CloneControl(ctrl, newID)
        If newCtrl IsNot Nothing Then
            newPanel.Controls.Add(newCtrl)
        End If
    Next

    ' âœ… æ–°å¢å°æ‡‰çš„ CheckBox
    Dim newCheckBox As New CheckBox()
    newCheckBox.ID = "chk_" & newID
    newCheckBox.Text = "å¡«å…¥æ•¸æ“š " & newID
    newCheckBox.AutoPostBack = True
    AddHandler newCheckBox.CheckedChanged, AddressOf CheckBox_Changed

    ' âœ… è¨˜éŒ„ CheckBox èˆ‡ Panel çš„é—œè¯
    ViewState(newCheckBox.ID) = newPanel.ID

    ' âœ… åœ¨ PlaceHolder åŠ å…¥ CheckBox èˆ‡ Panel
    PlaceHolder1.Controls.Add(newCheckBox)
    PlaceHolder1.Controls.Add(New LiteralControl("<br/>"))
    PlaceHolder1.Controls.Add(newPanel)

    Return newPanel
End Function


---

âœ… 3ï¸âƒ£ ClonePanelWithModification() - å…è¨±æ–°å¢ Panel ä¸¦ä¿®æ”¹ DropDownList

' âœ… å…è¨±ä½¿ç”¨è€…æ–°å¢ç›¸åŒçš„ Panelï¼Œç¢ºä¿ DropDownList ä¹Ÿè¤‡è£½
Private Function ClonePanelWithModification(originalPanel As Panel) As Panel
    ' å–å¾—æ–° Panel ID
    Dim newID As String = "Panel_" & (CInt(ViewState("PanelCount")) + 1)
    ViewState("PanelCount") = CInt(ViewState("PanelCount")) + 1

    ' âœ… ç”¢ç”Ÿæ–° Panel
    Dim newPanel As Panel = ClonePanel(originalPanel, newID)

    ' âœ… è®“ Quantity å¯æ‰‹å‹•è¼¸å…¥
    Dim txtQuantity As TextBox = CType(RecursiveFindControl(newPanel, "txt_Quantity_" & newID), TextBox)
    If txtQuantity IsNot Nothing Then
        txtQuantity.Text = "" ' æ¸…ç©ºæ•¸é‡ï¼Œè®“ä½¿ç”¨è€…è‡ªè¡Œè¼¸å…¥
        txtQuantity.Enabled = True
    End If

    ' âœ… æ–°å¢ã€Œåˆªé™¤ã€æŒ‰éˆ•
    Dim btnDelete As New Button()
    btnDelete.Text = "åˆªé™¤"
    btnDelete.CommandArgument = newID
    AddHandler btnDelete.Click, AddressOf RemovePanel

    newPanel.Controls.Add(btnDelete)

    ' âœ… æ–°å¢ Panel åˆ° PlaceHolder
    PlaceHolder1.Controls.Add(New LiteralControl("<br/>"))
    PlaceHolder1.Controls.Add(newPanel)

    Return newPanel
End Function


---

âœ… 4ï¸âƒ£ æ¸¬è©¦æ–¹å¼

1. é»æ“Šã€Œæ–°å¢ Panelã€æŒ‰éˆ•ï¼Œç¢ºä¿ DropDownList ä¹Ÿè¢«è¤‡è£½


2. é¸æ“‡ DropDownList çš„å€¼ï¼Œç¢ºä¿è¤‡è£½å¾Œä»ç„¶å­˜åœ¨


3. æª¢æŸ¥ PostBack ä¹‹å¾Œ DropDownList çš„é¸æ“‡å€¼æ˜¯å¦ä»ç„¶æ­£ç¢º


4. é»æ“Šã€Œåˆªé™¤ã€æŒ‰éˆ•ï¼Œç¢ºä¿ Panel åŠå…¶ DropDownList è¢«åˆªé™¤




---

âœ… çµè«–

âœ… å…è¨± DropDownList è¢«æ­£ç¢ºè¤‡è£½
âœ… è¤‡è£½å¾Œçš„ DropDownList ä¿æŒåŸæœ‰çš„é¸é …
âœ… ç¢ºä¿ PostBack ä¹‹å¾Œ DropDownList ä»ä¿ç•™é¸æ“‡çš„å€¼
âœ… å…è¨±åˆªé™¤ Panel æ™‚ï¼ŒDropDownList ä¹Ÿè¢«åˆªé™¤ ğŸš€



åœ¨ ASP.NET Web Forms (VB) ä¸­ï¼Œå¦‚æœè¦ å‹•æ…‹è¤‡è£½ (Clone) æ§åˆ¶é …ï¼Œå› ç‚º WebForms çš„æ§ä»¶æ˜¯ ä¼ºæœå™¨ç«¯æ§åˆ¶ï¼Œä¸èƒ½åƒ JavaScript é‚£æ¨£ç°¡å–®è¤‡è£½ HTMLï¼Œè€Œæ˜¯éœ€è¦åœ¨ ç¨‹å¼ç¢¼å¾Œç«¯ (VB) å‹•æ…‹å»ºç«‹æ–°çš„ DropDownList æ§ä»¶ä¸¦åŠ å…¥ PlaceHolder æˆ– Panel ä¸­ã€‚


---

1. Clone DropDownList (è¤‡è£½ DropDownList)

å‡è¨­ä½ æœ‰ä¸€å€‹ DropDownListï¼Œä½ æƒ³è¦åœ¨æŒ‰ä¸‹æŒ‰éˆ•æ™‚ è¤‡è£½ä¸€ä»½ï¼Œå¯ä»¥é€™æ¨£åšï¼š

(1) å‰ç«¯ (ASPX)

<asp:PlaceHolder ID="phControls" runat="server"></asp:PlaceHolder>
<asp:Button ID="btnClone" runat="server" Text="è¤‡è£½ DropDownList" OnClick="btnClone_Click" />

é€™è£¡ï¼š

PlaceHolder æ˜¯ å‹•æ…‹åŠ å…¥æ§åˆ¶é … çš„å®¹å™¨ã€‚

Button æ˜¯ç”¨ä¾†è§¸ç™¼ è¤‡è£½ DropDownList çš„æŒ‰éˆ•ã€‚



---

(2) å¾Œç«¯ (VB)

Protected Sub btnClone_Click(ByVal sender As Object, ByVal e As EventArgs)
    Dim ddlNew As New DropDownList() ' å»ºç«‹æ–°çš„ DropDownList
    ddlNew.ID = "ddlClone_" & phControls.Controls.Count ' è¨­å®šå”¯ä¸€ ID
    ddlNew.Items.Add(New ListItem("åŒæ„ (Accepted)", "Accepted"))
    ddlNew.Items.Add(New ListItem("æ‹’çµ• (Rejected)", "Rejected"))

    ' åŠ å…¥åˆ° PlaceHolder æ§ä»¶ä¸­
    phControls.Controls.Add(ddlNew)
    phControls.Controls.Add(New LiteralControl("<br/>")) ' åŠ å…¥æ›è¡Œ
End Sub


---

2. Clone ä»»ä½• ASP.NET æ§åˆ¶é … (é€šç”¨æ–¹æ³•)

å¦‚æœä½ æƒ³è¦ è¤‡è£½ä»»ä½•æ§åˆ¶é … (ä¸é™ DropDownList)ï¼Œå¯ä»¥å»ºç«‹ å‡½å¼ ä¾† Clone æ§åˆ¶é …ï¼š

(1) é€šç”¨ Clone æ–¹æ³•

Private Function CloneControl(ByVal original As Control) As Control
    Dim cloned As Control = Activator.CreateInstance(original.GetType()) ' å»ºç«‹ç›¸åŒé¡å‹çš„æ§åˆ¶é …

    ' è¤‡è£½åŸºæœ¬å±¬æ€§
    cloned.ID = original.ID & "_Clone_" & phControls.Controls.Count
    If TypeOf original Is DropDownList Then
        Dim ddlOriginal As DropDownList = CType(original, DropDownList)
        Dim ddlClone As DropDownList = CType(cloned, DropDownList)
        ddlClone.Items.Clear()
        For Each item As ListItem In ddlOriginal.Items
            ddlClone.Items.Add(New ListItem(item.Text, item.Value))
        Next
    End If

    Return cloned
End Function

(2) æŒ‰éˆ•è§¸ç™¼ Clone

Protected Sub btnClone_Click(ByVal sender As Object, ByVal e As EventArgs)
    ' æ‰¾åˆ°åŸå§‹çš„ DropDownList (å‡è¨­ ID ç‚º ddlEdi855Response)
    Dim originalDdl As DropDownList = TryCast(FindControl("ddlEdi855Response"), DropDownList)
    If originalDdl IsNot Nothing Then
        Dim clonedDdl As DropDownList = CType(CloneControl(originalDdl), DropDownList)
        phControls.Controls.Add(clonedDdl)
        phControls.Controls.Add(New LiteralControl("<br/>"))
    End If
End Sub


---

3. è®“ Clone çš„æ§åˆ¶é … ä¿æŒç‹€æ…‹ (ViewState)

å› ç‚ºå‹•æ…‹å»ºç«‹çš„æ§ä»¶ ä¸æœƒè‡ªå‹•ä¿æŒ ViewStateï¼Œç•¶é é¢é‡æ–°æ•´ç†æ™‚æœƒæ¶ˆå¤±ã€‚ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œä½ å¯ä»¥ï¼š

1. åœ¨ Page_Load ä¸­é‡æ–°è¼‰å…¥æ§åˆ¶é …


2. å­˜å„² Clone æ•¸é‡


3. åœ¨ Page_Init é‡æ–°å»ºç«‹æ§ä»¶



ä¿®æ”¹ Page_Load

Protected Sub Page_Load(ByVal sender As Object, ByVal e As EventArgs) Handles Me.Load
    If IsPostBack Then
        ' é‡æ–°åŠ è¼‰ Clone çš„ DropDownList
        Dim count As Integer = ViewState("CloneCount")
        For i As Integer = 1 To count
            Dim ddlNew As New DropDownList()
            ddlNew.ID = "ddlClone_" & i
            ddlNew.Items.Add(New ListItem("åŒæ„ (Accepted)", "Accepted"))
            ddlNew.Items.Add(New ListItem("æ‹’çµ• (Rejected)", "Rejected"))
            phControls.Controls.Add(ddlNew)
            phControls.Controls.Add(New LiteralControl("<br/>"))
        Next
    End If
End Sub

ä¿®æ”¹ btnClone_Click

Protected Sub btnClone_Click(ByVal sender As Object, ByVal e As EventArgs)
    Dim count As Integer = If(ViewState("CloneCount"), 0) + 1
    ViewState("CloneCount") = count ' å„²å­˜ Clone æ•¸é‡

    Dim ddlNew As New DropDownList()
    ddlNew.ID = "ddlClone_" & count
    ddlNew.Items.Add(New ListItem("åŒæ„ (Accepted)", "Accepted"))
    ddlNew.Items.Add(New ListItem("æ‹’çµ• (Rejected)", "Rejected"))

    phControls.Controls.Add(ddlNew)
    phControls.Controls.Add(New LiteralControl("<br/>"))
End Sub


---

çµè«–

å¦‚æœ åªéœ€è¦ Clone DropDownListï¼Œç›´æ¥åœ¨ btnClone_Click å»ºç«‹æ–°çš„ DropDownListã€‚

å¦‚æœ è¦ Clone ä»»ä½•æ§åˆ¶é …ï¼Œä½¿ç”¨ CloneControl() æ–¹æ³•ã€‚

ç¢ºä¿ Clone çš„æ§åˆ¶é …ä¸æœƒåœ¨ PostBack æ™‚æ¶ˆå¤±ï¼Œéœ€è¦ä½¿ç”¨ ViewState ä¾†ä¿å­˜æ•¸é‡ï¼Œä¸¦åœ¨ Page_Load é‡æ–°è¼‰å…¥ã€‚


é€™æ¨£å¯ä»¥ç¢ºä¿ æ¯æ¬¡æŒ‰æŒ‰éˆ•æ™‚è¤‡è£½ DropDownListï¼Œä¸” é é¢é‡æ–°æ•´ç†å¾Œ Clone çš„æ§ä»¶ä»ç„¶å­˜åœ¨ï¼



å¦‚æœ DropDownList çš„ é è¨­é¸é … éœ€è¦æ˜¯ åŒæ„ (Accepted)ï¼Œè«‹ä¿®æ”¹ Page_Load å¦‚ä¸‹ï¼š


---

1. å‰ç«¯ (ASPX) è¨­è¨ˆ DropDownList

<asp:DropDownList ID="ddlEdi855Response" runat="server" AutoPostBack="True" OnSelectedIndexChanged="ddlEdi855Response_SelectedIndexChanged">
    <asp:ListItem Text="åŒæ„ (Accepted)" Value="Accepted" />
    <asp:ListItem Text="æ‹’çµ• (Rejected)" Value="Rejected" />
</asp:DropDownList>

<asp:Label ID="lblResult" runat="server" />

å»æ‰ã€Œè«‹é¸æ“‡ã€ï¼Œè®“ DropDownList é è¨­é¡¯ç¤º åŒæ„ã€‚

Value="Accepted" æœƒæ˜¯ é è¨­å€¼ã€‚



---

2. å¾Œç«¯ (VB) è¨­å®šé è¨­é¸æ“‡

Protected Sub Page_Load(ByVal sender As Object, ByVal e As EventArgs) Handles Me.Load
    If Not IsPostBack Then
        ddlEdi855Response.SelectedValue = "Accepted" ' é è¨­é¸æ“‡ã€ŒåŒæ„ã€
    End If
End Sub

Protected Sub ddlEdi855Response_SelectedIndexChanged(ByVal sender As Object, ByVal e As EventArgs)
    Dim selectedValue As String = ddlEdi855Response.SelectedValue
    If selectedValue = "Accepted" Then
        lblResult.Text = "ä½ é¸æ“‡äº†ï¼šåŒæ„ (Accepted)"
    ElseIf selectedValue = "Rejected" Then
        lblResult.Text = "ä½ é¸æ“‡äº†ï¼šæ‹’çµ• (Rejected)"
    End If
End Sub


---

3. çµæœ

é é¢è¼‰å…¥æ™‚ï¼ŒDropDownList è‡ªå‹•é¸æ“‡ã€ŒåŒæ„ (Accepted)ã€ã€‚

ä½¿ç”¨è€…å¯ä»¥æ‰‹å‹•æ”¹è®Šé¸æ“‡ï¼Œè®Šæ›´å¾Œæœƒé¡¯ç¤ºå°æ‡‰çµæœã€‚


é€™æ¨£å°±ç¢ºä¿ é è¨­ç‚ºã€ŒåŒæ„ã€ï¼Œä½†ä»èƒ½é¸æ“‡ã€Œæ‹’çµ•ã€ã€‚

