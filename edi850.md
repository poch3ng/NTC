以下是完整解析帶有 ~ 當作換行符號的 EDI 資料的 VB.NET 程式碼範例：


---

程式碼

Imports System.IO

Module Module1
    Sub Main()
        ' 設定檔案路徑
        Dim filePath As String = "D:\edi850.txt"

        ' 確認檔案是否存在
        If Not File.Exists(filePath) Then
            Console.WriteLine("檔案不存在: " & filePath)
            Return
        End If

        ' 讀取 EDI 檔案
        Dim ediData As String = File.ReadAllText(filePath)

        ' 分割段落（以 ~ 作為分隔符）
        Dim segments As String() = ediData.Split("~"c)

        ' 儲存解析結果
        Dim results As New List(Of String)()

        ' 逐段解析
        For Each segment As String In segments
            Dim elements As String() = segment.Split("*"c)
            Select Case elements(0)
                Case "ISA" ' ISA 段解析
                    results.Add($"ISA Segment: Sender ID: {elements(6)}, Receiver ID: {elements(8)}, Date: {elements(9)}")
                Case "GS" ' GS 段解析
                    results.Add($"GS Segment: Functional ID: {elements(1)}, Sender Code: {elements(2)}, Receiver Code: {elements(3)}, Date: {elements(4)}")
                Case "ST" ' ST 段解析
                    results.Add($"ST Segment: Transaction Set ID: {elements(1)}, Control Number: {elements(2)}")
                Case "BEG" ' BEG 段解析
                    results.Add($"BEG Segment: PO Type: {elements(1)}, PO Number: {elements(3)}, PO Date: {elements(5)}")
                Case "REF" ' REF 段解析
                    results.Add($"REF Segment: Reference ID: {elements(2)}")
                Case "PER" ' PER 段解析
                    results.Add($"PER Segment: Contact Name: {elements(2)}, Phone: {elements(4)}")
                Case "N1" ' N1 段解析
                    results.Add($"N1 Segment: Name: {elements(2)}, ID Code: {elements(4)}")
                Case "N3" ' N3 段解析
                    results.Add($"N3 Segment: Address: {elements(1)}")
                Case "N4" ' N4 段解析
                    results.Add($"N4 Segment: City: {elements(1)}, State: {elements(2)}, ZIP: {elements(3)}")
                Case "PO1" ' PO1 段解析（商品資訊）
                    Dim quantity As String = elements(2)
                    Dim price As String = elements(4)
                    Dim upc As String = elements(7)
                    results.Add($"PO1 Segment: Quantity: {quantity}, Price: {price}, UPC: {upc}")
                Case "PID" ' PID 段解析（商品描述）
                    results.Add($"PID Segment: Description: {elements(5)}")
                Case "CTT" ' CTT 段解析
                    results.Add($"CTT Segment: Total Line Items: {elements(1)}")
                Case "SE" ' SE 段解析
                    results.Add($"SE Segment: Segment Count: {elements(1)}, Control Number: {elements(2)}")
                Case Else
                    results.Add($"Unknown Segment: {segment}")
            End Select
        Next

        ' 輸出解析結果
        For Each result As String In results
            Console.WriteLine(result)
        Next
    End Sub
End Module


---

程式執行流程

1. 檔案載入：

將 EDI 資料儲存在 D:\edi850.txt。

程式會確認檔案是否存在，若無則提示檔案不存在。



2. 解析邏輯：

使用 ~ 分割段落。

將每個段落的 * 作為欄位分隔符解析。

針對常見的 EDI 段落（如 ISA、BEG、PO1 等）進行解析。



3. 輸出結果：

程式會將每個段落的解析結果顯示在終端機上。





---

測試資料解析結果

假設測試資料如下：

ISA*00*          *00*          *ZZ*A1STORES    *12*5142645505     *190510*0728*|*00403*100000013*0*P*~
GS*PO*A1STORES*5142645505*20200510*0728*1013*X*004030~
ST*850*1013~
BEG*00*SA*2332233**20200510~
PO1*1*4*EA*4.15**UP*066810348563*IT*WACT750SP16-BLK~
PID*F*08***Nike Boy Short Black sz M~
CTT*3~
SE*22*1013~

執行結果將會是：

ISA Segment: Sender ID: A1STORES, Receiver ID: 5142645505, Date: 190510
GS Segment: Functional ID: PO, Sender Code: A1STORES, Receiver Code: 5142645505, Date: 20200510
ST Segment: Transaction Set ID: 850, Control Number: 1013
BEG Segment: PO Type: SA, PO Number: 2332233, PO Date: 20200510
PO1 Segment: Quantity: 4, Price: 4.15, UPC: 066810348563
PID Segment: Description: Nike Boy Short Black sz M
CTT Segment: Total Line Items: 3
SE Segment: Segment Count: 22, Control Number: 1013


---

注意事項

1. 檔案格式：檢查檔案是否使用正確的分隔符號（~ 和 *）。


2. 段落支援：如需處理其他段落，可擴展 Select Case 的邏輯。


3. 輸出儲存：結果可以直接儲存到檔案或資料庫中。



這樣可以解析完整的 EDI 資料，並針對每個段落提供清晰的結果！



要用 VB.NET 來處理 Amazon EDI 850 購買訂單的資料，可以按照以下步驟解析 EDI 文件並提取所需的資訊：


---

步驟 1：讀取 EDI 資料

首先，將 EDI 資料儲存到檔案中（例如 edi850.txt），然後使用 VB.NET 的檔案讀取功能載入資料。

Dim ediData As String = System.IO.File.ReadAllText("edi850.txt")


---

步驟 2：將資料分割成段落

EDI 段落通常以特定的分隔符號結尾，例如 ~ 或 \n。這份測試資料使用 * 作為分隔符，因此可以先按行分割，再分割字段。

Dim segments As String() = ediData.Split(New String() {"\r\n", "\n"}, StringSplitOptions.None)


---

步驟 3：解析 EDI 段落

依據 EDI 標準，解析段落並提取有用的資訊，例如購買訂單號碼、商品明細等。

範例：解析 BEG 段落中的購買訂單號碼

Dim purchaseOrderNumber As String = ""
For Each segment As String In segments
    Dim elements As String() = segment.Split("*"c)
    If elements(0) = "BEG" Then
        purchaseOrderNumber = elements(3)
        Exit For
    End If
Next

Console.WriteLine("Purchase Order Number: " & purchaseOrderNumber)

範例：解析 PO1 段落中的商品資訊

Dim items As New List(Of String)()
For Each segment As String In segments
    Dim elements As String() = segment.Split("*"c)
    If elements(0) = "PO1" Then
        Dim quantity As String = elements(2)
        Dim price As String = elements(4)
        Dim upc As String = elements(7)
        items.Add($"Quantity: {quantity}, Price: {price}, UPC: {upc}")
    End If
Next

For Each item As String In items
    Console.WriteLine(item)
Next


---

步驟 4：輸出或儲存結果

解析後的結果可以儲存到資料庫、CSV 檔案，或直接顯示於介面。


---

範例完整程式碼

以下是完整的 VB.NET 範例程式碼：

Imports System.IO

Module Module1
    Sub Main()
        ' 讀取 EDI 檔案
        Dim ediData As String = File.ReadAllText("edi850.txt")

        ' 分割段落
        Dim segments As String() = ediData.Split(New String() {"\r\n", "\n"}, StringSplitOptions.None)

        ' 解析購買訂單號碼
        Dim purchaseOrderNumber As String = ""
        Dim items As New List(Of String)()

        For Each segment As String In segments
            Dim elements As String() = segment.Split("*"c)

            ' 解析 BEG 段
            If elements(0) = "BEG" Then
                purchaseOrderNumber = elements(3)
            End If

            ' 解析 PO1 段
            If elements(0) = "PO1" Then
                Dim quantity As String = elements(2)
                Dim price As String = elements(4)
                Dim upc As String = elements(7)
                items.Add($"Quantity: {quantity}, Price: {price}, UPC: {upc}")
            End If
        Next

        ' 顯示結果
        Console.WriteLine("Purchase Order Number: " & purchaseOrderNumber)
        For Each item As String In items
            Console.WriteLine(item)
        Next
    End Sub
End Module


---

執行結果

輸入測試資料後，結果可能如下：

Purchase Order Number: 2332233
Quantity: 4, Price: 4.15, UPC: 066810348563
Quantity: 6, Price: 5.00, UPC: 066810349983
Quantity: 4, Price: 5.25, UPC: 066810349747

這段程式碼可以根據需求進一步擴展，例如處理更多的 EDI 段落或將結果儲存至資料庫。

