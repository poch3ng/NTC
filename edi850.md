要用 VB.NET 來處理 Amazon EDI 850 購買訂單的資料，可以按照以下步驟解析 EDI 文件並提取所需的資訊：


---

步驟 1：讀取 EDI 資料

首先，將 EDI 資料儲存到檔案中（例如 edi850.txt），然後使用 VB.NET 的檔案讀取功能載入資料。

Dim ediData As String = System.IO.File.ReadAllText("edi850.txt")


---

步驟 2：將資料分割成段落

EDI 段落通常以特定的分隔符號結尾，例如 ~ 或 \n。這份測試資料使用 * 作為分隔符，因此可以先按行分割，再分割字段。

Dim segments As String() = ediData.Split(New String() {"\r\n", "\n"}, StringSplitOptions.None)


---

步驟 3：解析 EDI 段落

依據 EDI 標準，解析段落並提取有用的資訊，例如購買訂單號碼、商品明細等。

範例：解析 BEG 段落中的購買訂單號碼

Dim purchaseOrderNumber As String = ""
For Each segment As String In segments
    Dim elements As String() = segment.Split("*"c)
    If elements(0) = "BEG" Then
        purchaseOrderNumber = elements(3)
        Exit For
    End If
Next

Console.WriteLine("Purchase Order Number: " & purchaseOrderNumber)

範例：解析 PO1 段落中的商品資訊

Dim items As New List(Of String)()
For Each segment As String In segments
    Dim elements As String() = segment.Split("*"c)
    If elements(0) = "PO1" Then
        Dim quantity As String = elements(2)
        Dim price As String = elements(4)
        Dim upc As String = elements(7)
        items.Add($"Quantity: {quantity}, Price: {price}, UPC: {upc}")
    End If
Next

For Each item As String In items
    Console.WriteLine(item)
Next


---

步驟 4：輸出或儲存結果

解析後的結果可以儲存到資料庫、CSV 檔案，或直接顯示於介面。


---

範例完整程式碼

以下是完整的 VB.NET 範例程式碼：

Imports System.IO

Module Module1
    Sub Main()
        ' 讀取 EDI 檔案
        Dim ediData As String = File.ReadAllText("edi850.txt")

        ' 分割段落
        Dim segments As String() = ediData.Split(New String() {"\r\n", "\n"}, StringSplitOptions.None)

        ' 解析購買訂單號碼
        Dim purchaseOrderNumber As String = ""
        Dim items As New List(Of String)()

        For Each segment As String In segments
            Dim elements As String() = segment.Split("*"c)

            ' 解析 BEG 段
            If elements(0) = "BEG" Then
                purchaseOrderNumber = elements(3)
            End If

            ' 解析 PO1 段
            If elements(0) = "PO1" Then
                Dim quantity As String = elements(2)
                Dim price As String = elements(4)
                Dim upc As String = elements(7)
                items.Add($"Quantity: {quantity}, Price: {price}, UPC: {upc}")
            End If
        Next

        ' 顯示結果
        Console.WriteLine("Purchase Order Number: " & purchaseOrderNumber)
        For Each item As String In items
            Console.WriteLine(item)
        Next
    End Sub
End Module


---

執行結果

輸入測試資料後，結果可能如下：

Purchase Order Number: 2332233
Quantity: 4, Price: 4.15, UPC: 066810348563
Quantity: 6, Price: 5.00, UPC: 066810349983
Quantity: 4, Price: 5.25, UPC: 066810349747

這段程式碼可以根據需求進一步擴展，例如處理更多的 EDI 段落或將結果儲存至資料庫。

